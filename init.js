!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/pms-console/",t(t.s=1)}([function(module,exports,__webpack_require__){"use strict";function init(){pms.workspace||(pms.workspace={}),pms.onLeavePage||(pms.onLeavePage=[]),pms.appearance||(pms.appearance={}),pms.appearance.loadIndicators||(pms.appearance.loadIndicators={}),pms.progressState||(pms.progressState={}),window.addEventListener("touchstart",function e(){document.body.classList.toggle("touchscreen",!0),window.removeEventListener("touchstart",e,!1)},!1),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(pms.workspace.iOS=!0,"standalone"in window.navigator&&window.navigator.standalone&&document.body.classList.toggle("ios-standalone",!0)):-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&navigator.userAgent.toLowerCase().indexOf("chrome")<0?pms.workspace.macOs=!0:document.body.classList.toggle("material",!0)}function _require(e){return io(!1,!1,!1,"./assets/js/"+e+".js",!0).then(function(e){if(!e)return!1;try{eval.apply(window,[e])}catch(e){return console.error(e),!1}return!0})}function prepare(){return init(),initHistoryHandler.bind(this)(),showLoadingIndicator(),template.wrapper?updateHostsData().then(function(){return render(template.wrapper)}).then(loadHost).then(renderHostsSelectMenu).then(loadNotifications).then(hideLoadingIndicator):loadTemplate("wrapper").then(function(e){return e?template.wrapper=e:(alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É"),!1)}).then(updateHostsData).then(function(){return render(template.wrapper)}).then(loadHost).then(renderHostsSelectMenu).then(loadNotifications).then(hideLoadingIndicator)}function initHistoryHandler(){window.addEventListener("popstate",function(e){e.state&&e.state.type&&"workspace"===e.state.type&&(leavePage(),document.querySelector("#workspace-wrapper").innerHTML='<div class="flex-center center-text">\n            <div><h3 class="slim-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3><br>\n                <h3 class="slim-subtitle">–î–ª—è –Ω–∞—á–∞–ª–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ä–∞–∑–¥–µ–ª –≤ <span\n                        class="hide-on-mobile">–±–æ–∫–æ–≤–æ–º</span><span class="hide-on-desktop">–≤–µ—Ä—Ö–Ω–µ–º</span> –ú–µ–Ω—é</h3>\n            </div>\n        </div>')}.bind(this)),history.pushState({type:"workspace"},"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Cotton Baby")}function prepareWrapper(){pms.selectedHost?(pms.selectedHost.title&&document.getElementById("host-name")&&(document.getElementById("host-name").innerText=pms.selectedHost.title),pms.selectedHost.logo&&document.getElementById("host-logo")&&(document.getElementById("host-logo").src=pms.selectedHost.logo),pms.selectedHost.homePage&&document.getElementById("home-page")&&(document.getElementById("home-page").href=pms.selectedHost.homePage)):pms.currentHost&&(pms.currentHost.title&&document.getElementById("host-name")&&(document.getElementById("host-name").innerText=pms.currentHost.title),pms.currentHost.logo&&document.getElementById("host-logo")&&(document.getElementById("host-logo").src=pms.currentHost.logo),pms.currentHost.homePage&&document.getElementById("home-page")&&(document.getElementById("home-page").href=pms.currentHost.homePage)),document.getElementById("select-hosts-menu")&&document.getElementById("select-hosts-menu").addEventListener("change",function(){selectHost(this.value)}),document.getElementById("header-menu-button")&&document.getElementById("header-menu-button").addEventListener("click",toggleMobileMenu);var e=pms.userData.firstname?pms.userData.firstname+(pms.userData.lastname?" "+pms.userData.lastname:""):pms.userData.login?pms.userData.login:"–õ—é–±–∏–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";return document.getElementById("user-name")&&(document.getElementById("user-name").innerText=e),pms.userData.avamoji&&document.getElementById("user-avamoji")&&(document.getElementById("user-avamoji").innerText=pms.userData.avamoji),document.getElementById("workspace-menu")&&(pms.workspace.menu=document.getElementById("workspace-menu")),document.getElementById("workspace-wrapper")&&(pms.workspace.wrapper=document.getElementById("workspace-wrapper")),document.getElementById("notificationsWrapper")&&(pms.workspace.notificationsWrapper=document.getElementById("notificationsWrapper")),!0}function loadTemplate(e){return io(!1,!1,!1,"./"+e+".html",!0).then(function(e){return"string"==typeof e&&e})}function render(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;return init(),leavePage(),new Promise(function(n,o){return!!e&&(t.innerHTML=e,n(t))})}function updateHostsData(){return io("console/getHosts").then(function(e){if(!e.status)return!1;if(e.hostsData){pms.hostsData||(pms.hostsData={}),pms.domainsHost||(pms.domainsHost={});for(var t in e.hostsData)pms.hostsData[e.hostsData[t].id]=e.hostsData[t],pms.domainsHost[e.hostsData[t].domain]=e.hostsData[t]}return!0})}function renderHostsSelectMenu(){var e="<option selected disabled>üåê –í—ã–±—Ä–∞—Ç—å –°–∞–π—Ç</option>",t=Object.keys(pms.hostsData);for(var n in t){var o=pms.hostsData[t[n]],i=o.title?o.title:o.domain;e+='<option value="'+o.id+'" >'+i+"</option>"}var r=document.getElementById("select-hosts-menu");return r.innerHTML=e,t.length>1?r.parentNode.style.display="initial":r.parentNode.style.display="none",!0}function loadHost(e){return leavePage(),new Promise(function(t,n){if(!pms.hostsData)return t(!1);(!e||"string"!=typeof e&&"number"!=typeof e)&&(e=!1,pms.currentHost&&pms.currentHost.domain&&pms.domainsHost[pms.currentHost.domain]&&(e=pms.domainsHost[pms.currentHost.domain].id),e=e||Object.keys(pms.hostsData)[0]);var o=pms.selectedHost=pms.hostsData[e];return t(o.modules?new Promise(function(e,t){return e(prepareWrapper())}).then(loadMenu):getHostModules(o.id).then(function(e){return e?o:e}).then(prepareWrapper).then(loadMenu))})}function getHostModules(e){return io("console/getModules",{hostId:e}).then(function(t){if(!t.status)return!1;var n=pms.hostsData[e];n.menuStructure=[],n.modules||(n.modules={});for(var o in t.modulesData){var i=t.modulesData[o];pms.module||(pms.module={}),pms.module[i.id]||(pms.module[i.id]=i),n.modules[i.id]=pms.module[i.id],n.menuStructure.push(n.modules[i.id])}return!0})}function getModuleData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t=t||pms.selectedHost.id,new Promise(function(n,o){return n(pms.hostsData[t].modules[e].init?e:io("console/getModuleData",{moduleId:e,hostId:t}).then(function(n){return!(!n.status||!n.init)&&(pms.hostsData[t].modules[e].init=n.init,e)}))})}function loadModule(moduleId){return new Promise(function(resolve,reject){if(!pms.module[moduleId]||!pms.module[moduleId].init)return resolve(!1);if(pms.module[moduleId].loaded)return resolve(!0);try{eval(pms.module[moduleId].init)}catch(e){reject(e)}return pms.module[moduleId].loaded=!0,resolve(!0)})}function loadMenu(){if(!pms.selectedHost||!pms.selectedHost.modules)return!1;var e=pms.selectedHost.menuStructure?pms.selectedHost.menuStructure:pms.selectedHost.modules,t="<h2>–ú–µ–Ω—é:</h2><ul>";for(var n in e){var o=pms.module[e[n].id],i=o.menu_item_title?o.menu_item_title:o.title?o.title:o.id,r=o.description?"<p>"+o.description+"</p>":"";t+='<li data-menu-item="'+o.id+'" onclick="menuItemClick(\''+o.id+'\')"><a href="javascript:void(0);"><span>'+i+"</span>"+r+'</a></li><ul data-menu-item-container="'+o.id+'"></ul>'}return t+="</ul>",pms.workspace.menu&&(pms.workspace.menu.innerHTML=t),!0}function menuItemClick(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(isProgress("menuItem"))return!1;setProgress("menuItem");var i=pms.module[e];if(t||(t=e),showItemLoadIndicator(t,"menu-item"),showLoadingIndicator(),n)if(o){if("item"===o){if(i.workspaceGenerator)return i.workspaceGenerator(n).catch(errorHandler).then(function(e){return setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item"),toggleMobileMenu(!1),e})}else if("group"===o&&i.menuItemsWorker)return i.menuItemsWorker(n).catch(errorHandler).then(function(n){return setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item"),!n.menuItems||renderMenuItems(e,t,n.menuItems)})}else;else if(i.menu_item_type&&"item"===i.menu_item_type)if(i.loaded){if(i.workspaceGenerator)return i.workspaceGenerator().then(function(e){return setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item"),toggleMobileMenu(!1),e})}else getModuleData(e).then(loadModule).catch(function(e){return!1}).then(function(e){return e&&i.loaded||alert("–†–∞–∑–¥–µ–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"),i.workspaceGenerator?i.workspaceGenerator():{status:!0}}).then(function(t){return"object"===(void 0===t?"undefined":_typeof(t))&&(t.status||console.debug(e,t.statusText?t.statusText:t),!0)}).then(function(e){return setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item"),toggleMobileMenu(!1),e});else if(i.menu_item_type&&"group"===i.menu_item_type){if(i.loaded){if(i.menuItemsWorker)return i.menuItemsWorker().then(function(n){return console.debug(n),"object"===(void 0===n?"undefined":_typeof(n))&&(n.status||console.debug(e,n.statusText?n.statusText:n),!n.menuItems||renderMenuItems(e,t,n.menuItems))}).then(function(e){return setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item"),e})}else getModuleData(e).then(loadModule).catch(function(e){return!1}).then(function(e){return e&&i.loaded||alert("–†–∞–∑–¥–µ–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"),i.menuItemsWorker?i.menuItemsWorker():{status:!0}}).then(function(n){return"object"===(void 0===n?"undefined":_typeof(n))&&(n.status||console.debug(e,n.statusText?n.statusText:n),!n.menuItems||renderMenuItems(e,t,n.menuItems))}).then(function(e){return setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item"),e});setProgress("menuItem",!1),hideLoadingIndicator(),hideItemLoadIndicator(t,"menu-item")}}function showItemLoadIndicator(e,t){pms.appearance||(pms.appearance={}),pms.appearance.loadIndicators||(pms.appearance.loadIndicators={});var n=document.querySelectorAll("[data-"+t+'="'+e+'"]');if(!n||0===n.length)return!1;if(pms.appearance.loadIndicators[t+"-"+e])return!1;pms.appearance.loadIndicators[t+"-"+e]="initShow",n=n[0];var o=n.querySelector(".loader-spinner-wrapper");o&&0!==o.length||(n.innerHTML+='<div class="loader-spinner-wrapper">\n<div class="ispinner ispinner--gray ispinner--animating">\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n  <div class="ispinner__blade"></div>\n</div></div>'),setTimeout(function(){n.classList.toggle("loader-spinner-active",!0),pms.appearance.loadIndicators[t+"-"+e]="show"},100)}function hideItemLoadIndicator(e,t,n){if(pms.appearance.loadIndicators[t+"-"+e]&&"initShow"===pms.appearance.loadIndicators[t+"-"+e])return n||setTimeout(function(){hideItemLoadIndicator(e,t,!0)},100),!1;pms.appearance.loadIndicators[t+"-"+e]="initHide";var o=document.querySelector("[data-"+t+'="'+e+'"]');if(!o||0===o.length)return pms.appearance.loadIndicators[t+"-"+e]=!1,delete pms.appearance.loadIndicators[t+"-"+e],!1;o.classList.toggle("loader-spinner-active",!1),setTimeout(function(){var n=document.querySelector("[data-"+t+'="'+e+'"]');if(!n||0===n.length)return pms.appearance.loadIndicators[t+"-"+e]=!1,delete pms.appearance.loadIndicators[t+"-"+e],!1;var o=n.querySelector(".loader-spinner-wrapper");o&&o.length>0&&o[0].parentNode.removeChild(o[0]),pms.appearance.loadIndicators[t+"-"+e]=!1,delete pms.appearance.loadIndicators[t+"-"+e]},500)}function showLoadingIndicator(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return document.body.style.cursor="progress",e}function hideLoadingIndicator(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return document.body.style.cursor="default",e}function leavePage(){return new Promise(function(e,t){pms.onLeavePage||(pms.onLeavePage=[]);for(var n in pms.onLeavePage)if("function"==typeof pms.onLeavePage[n])try{pms.onLeavePage[n]()}catch(e){console.error(e)}pms.onLeavePage=[],e(!0)})}function selectHost(e){return render(template.wrapper).then(function(){return loadHost(e)}).then(renderHostsSelectMenu).then(hideLoadingIndicator)}function isProgress(e){return pms.progressState[e]}function setProgress(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return pms.progressState[e]=t,t||delete pms.progressState[e],!0}function renderMenuItems(e,t,n){var o=document.querySelectorAll('[data-menu-item-container="'+t+'"]');if(!o||0===o.length)return!1;var i="";for(var r in n){var s=n[r],a=s.menu_item_title?s.menu_item_title:s.title?s.title:s.id,d=s.description?"<p>"+s.description+"</p>":"",c=s.parameters?s.parameters:{};s.type||(s.type="item"),c.id=s.id,i+='<li data-menu-item="'+s.id+'" onclick=\'menuItemClick("'+e+'","'+s.id+'",'+JSON.stringify(c)+',"'+s.type+'")\'><a href="javascript:void(0);"><span>'+a+"</span>"+d+'</a></li><ul data-menu-item-container="'+s.id+'"></ul>'}return o[0]&&(o[0].innerHTML=i),!0}function getHostUrl(e,t){t||(t=pms.selectedHost.id);var n=pms.hostsData[t];return(n.https?"https://":"http://")+n.domain+(!e&&n.path?n.path+"/":"")}function loadNotifications(e){return pms.userData.notifications||(pms.userData.notifications=[]),io("console/getUserNotifications").then(function(e){if(!e.status||!e.notifications)return!1;pms.notifications=e.notifications,pms.notification||(pms.notification={});for(var t in pms.notifications)pms.notifications[t].id&&(pms.notification[pms.notifications[t].id]=pms.notifications[t]);return!0}).then(renderNotifications),e}function renderNotifications(){if(!pms.workspace.notificationsWrapper)return!1;if(!pms.notifications||0===pms.notifications.length)return!0;var e="";for(var t in pms.notifications){var n=pms.notifications[t];if(n.id){if(e+='<div class="notification background-blur" data-notification="'+n.id+'"><div class="notification-data"><div class="notification-header"><div class="notification-header-side">',n.icon&&(e+='<figure style="background-image: url('+n.icon+')"></figure>'),n.title&&(e+="<span>"+n.title+"</span>"),e+="</div>",n.time&&(e+='<div class="notification-header-side"><span>'+n.time+"</span></div>"),e+="</div>",n.body&&(e+='<div class="notification-body">'+n.body+"</div>"),e+='</div><div class="notification-control">',n.actions)for(var o in n.actions){var i=n.actions[o];e+='<button class="notification-control-item" data-notification-action="'+n.id+"_"+i.id+'" onclick="notifyAction(\''+n.id+"','"+i.id+"');\">"+i.title+"</button>"}else e+='<button class="notification-control-item" data-notification-action="'+n.id+'_close" onclick="notifyAction(\''+n.id+"','close');\">–ó–∞–∫—Ä—ã—Ç—å</button>";e+="</div></div>"}}return pms.workspace.notificationsWrapper.innerHTML=e,!0}function notifyAction(e,t){if(!e||!pms.notification[e])return!1;if(isProgress("notification_"+e))return!1;setProgress("notification_"+e);var n=pms.notification[e];return t&&"close"!==t?n.actions[t]?new Promise(function(o,i){var r=n.actions[t];o(function(){return showItemLoadIndicator(e+"_"+t,"notification-action"),!r.method||r.method(!!r.parameters&&r.parameters)}().then(function(t){return t?r.closeAfter?t:io("console/closeUserNotification",{notification:e}).then(function(e){return removeNotification(n.id).then(function(){return t})}):t}).then(function(){hideItemLoadIndicator(e+"_"+t,"notification-action"),setProgress("notification_"+e,!1)}))}):(setProgress("notification_"+e,!1),!1):n.local?(setProgress("notification_"+e,!1),removeNotification(n.id)):(showItemLoadIndicator(e+"_"+t,"notification-action"),io("console/closeUserNotification",{notification:e}).then(function(o){return hideItemLoadIndicator(e+"_"+t,"notification-action"),setProgress("notification_"+e,!1),removeNotification(n.id)}))}function removeNotification(e){if(!e)return!1;var t=document.querySelectorAll('[data-notification="'+e+'"]');t&&t.length>0&&t[0].parentNode.removeChild(t[0]),pms.notification[e]&&(pms.notification[e]=!1,delete pms.notification[e]);for(var n in pms.notifications)if(parseInt(pms.notifications[n].id)===parseInt(e)){pms.notifications.splice(n,1);break}return!0}function createNotification(e,t,n,o,i){o=o?pms.notification[o]?(new Date).getTime():o:(new Date).getTime();var r={id:o,title:e||!1,body:t||!1,icon:n||!1,actions:i||!1,local:!0};return pms.notification[o]=r,showNotification(r)}function showNotification(e){if(!pms.workspace.notificationsWrapper||!e)return!1;var t="",n=e;if(!n.id)return!1;if(t+='<div class="notification background-blur" data-notification="'+n.id+'"><div class="notification-data"><div class="notification-header"><div class="notification-header-side">',n.icon&&(t+='<figure style="background-image: url('+n.icon+')"></figure>'),n.title&&(t+="<span>"+n.title+"</span>"),t+="</div>",n.time&&(t+='<div class="notification-header-side"><span>'+n.time+"</span></div>"),t+="</div>",n.body&&(t+='<div class="notification-body">'+n.body+"</div>"),t+='</div><div class="notification-control">',n.actions)for(var o in n.actions){var i=n.actions[o];t+='<button class="notification-control-item" data-notification-action="'+n.id+"_"+o+'" onclick="notifyAction(\''+n.id+"','"+o+"');\">"+i.title+"</button>"}else t+='<button class="notification-control-item" data-notification-action="'+n.id+'_close" onclick="notifyAction(\''+n.id+"','close');\">–ó–∞–∫—Ä—ã—Ç—å</button>";return t+="</div></div>",pms.workspace.notificationsWrapper.innerHTML+=t,!0}function toggleMobileMenu(e){"boolean"==typeof e?document.body.classList.toggle("mobile-menu-show",e):document.body.classList.toggle("mobile-menu-show")}function errorHandler(e,t,n,o){console.error(t,e);var i={close:{id:"close",title:"–ó–∞–∫—Ä—ã—Ç—å"},report:{id:"report",title:"–û—Ç—á–µ—Ç",method:errorReport,parameters:e,closeAfter:!0}};return createNotification(n||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞!",t||e.message,o||pms.config.icon,!1,i),!0}function errorReport(e){return e={message:e.message,stack:e.stack,hostId:pms.selectedHost.id},io("console/errorHandler",e).then(function(e){return e.status})}function initPromise(e){return new Promise(function(t,n){return t(e)})}function importModule(e){return initPromise(e).then(function(e){var t=pms.module[e];return!(!t||!t.loaded)||getModuleData(e).then(loadModule).catch(function(e){return!1}).then(function(e){return!0})})}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports.init=init,exports.prepare=prepare,exports.loadTemplate=loadTemplate,exports.render=render,exports.updateHostsData=updateHostsData,exports.renderHostsSelectMenu=renderHostsSelectMenu,exports.loadHost=loadHost,exports.getHostModules=getHostModules,exports.getModuleData=getModuleData,exports.loadModule=loadModule,exports.loadMenu=loadMenu,exports.menuItemClick=menuItemClick,exports.showItemLoadIndicator=showItemLoadIndicator,exports.hideItemLoadIndicator=hideItemLoadIndicator,exports.showLoadingIndicator=showLoadingIndicator,exports.hideLoadingIndicator=hideLoadingIndicator,exports.leavePage=leavePage,exports.selectHost=selectHost,exports.isProgress=isProgress,exports.setProgress=setProgress,exports.renderMenuItems=renderMenuItems,exports.getHostUrl=getHostUrl,exports.loadNotifications=loadNotifications,exports.renderNotifications=renderNotifications,exports.notifyAction=notifyAction,exports.removeNotification=removeNotification,exports.createNotification=createNotification,exports.showNotification=showNotification,exports.errorHandler=errorHandler,exports.initPromise=initPromise,exports.importModule=importModule;var template={};window.menuItemClick=menuItemClick,window.workspace={render:render,loadTemplate:loadTemplate,require:_require,leavePage:leavePage,init:init},window.showLoadingIndicator=showLoadingIndicator,window.hideLoadingIndicator=hideLoadingIndicator,window.showItemLoadIndicator=showItemLoadIndicator,window.hideItemLoadIndicator=hideItemLoadIndicator,window.selectHost=selectHost,window.isProgress=isProgress,window.setProgress=setProgress,window.getHostUrl=getHostUrl,window.notifyAction=notifyAction,window.createNotification=createNotification,window.showNotification=showNotification,window.errorHandler=errorHandler,window.initPromise=initPromise,window.importModule=importModule,window.onerror=function(e,t,n){return errorHandler(arguments,e)},exports.require=_require},function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(){return window.pmsHostData&&(pms.currentHost=window.pmsHostData),f.check().then(function(e){return e?l.prepare():f.showLogin()})}function r(e,t,n,o,i){if(o=o||(pms.config.apiUrl?pms.config.apiUrl:"/api/")+e,n||(t=t||"","object"===(void 0===t?"undefined":u(t))&&(t=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"))),e){var r=!!localStorage.getItem("token")&&localStorage.getItem("token");r&&(n?t._token=r:t+=(""!==t?"&":"")+"_token="+r)}""===t||n||(o+="?"+t);var s={method:n?"POST":"GET",mode:"cors",credentials:"include"};return n&&(s.body=JSON.stringify(t)),fetch(o,s).then(function(e){return e.status>=200&&e.status<300?e:!i&&{status:!1,error:e.statusText}}).then(function(e){return e?i?e.text():e.json():e}).catch(function(n){var i=["Response parse error"];return n.message&&i.push(n.message),e&&i.push(e),""!==t&&i.push(e?decodeURIComponent(t):decodeURIComponent(o)),console.debug.apply(this,i),{status:!1,error:"Response parse error"}}).then(function(n){if(!n||n.error)return n;var i=[n.offline?"Offline mode":"Request successful"];return e&&i.push(e),""!==t&&i.push(e?decodeURIComponent(t):decodeURIComponent(o)),i.push(n),console.debug.apply(this,i),n.offline?c():pms.offline=!1,n}).catch(function(e){return console.error(e),{status:!1}})}function s(e,t,n,o,i){if(o=o||(pms.config.apiUrl?pms.config.apiUrl:"/api/")+e,t=t||"","object"===(void 0===t?"undefined":u(t))&&(t=a(t)),n=n||!1,"object"===(void 0===n?"undefined":u(n))&&(n=a(n)),e&&!d("token")){var r=localStorage.getItem("token");r&&(t+=(""!==t?"&":"")+"_token="+r)}""!==t&&(o+="?"+t);var s={method:n?"POST":"GET",mode:"cors",credentials:"include"};return n&&(s.body=n),fetch(o,s).then(function(e){return e.status>=200&&e.status<300?e:!i&&{status:!1,error:e.statusText}}).then(function(e){return e?i?e.text():e.json():e}).catch(function(i){var r=["Response parse error"];return i.message&&r.push(i.message),e&&r.push(e),""!==t&&r.push(e?decodeURIComponent(t):decodeURIComponent(o)),n&&e&&r.push(decodeURIComponent(n)),{status:!1,error:"Response parse error"}}).then(function(i){if(!i||i.error)return i;var r=[i.offline?"Offline mode":"Request successful"];return e&&r.push(e),""!==t&&r.push(e?decodeURIComponent(t):decodeURIComponent(o)),n&&e&&r.push(decodeURIComponent(n)),r.push(i),i.offline?c():pms.offline=!1,i}).catch(function(e){return{status:!1}})}function a(e,t){var n,o=[];for(n in e)if(e.hasOwnProperty(n)){var i=t?t+"["+n+"]":n,r=e[n];o.push(null!==r&&"object"===(void 0===r?"undefined":u(r))?a(r,i):encodeURIComponent(i)+"="+encodeURIComponent(r))}return o.join("&")}function d(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}function c(){return!0===pms.offline||(pms.offline=!0,alert("–ú—ã –ø–æ—Ç–µ—Ä—è–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ"),!0)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=n(0),l=o(m),p=n(2),f=o(p);window.pms={config:{apiUrl:"https://cms.prakula.ru/api/v1/",name:"PRakula CMS",icon:"/pms-console/assets/images/logo.small.png"}},window.io=s,window.oldIo=r,window.initApp=i,window.addEventListener("load",function(){pms.config.isFramed=!1;try{pms.config.isFramed=window!=window.top||document!=top.document||self.location!=top.location}catch(e){pms.config.isFramed=!0}pms.config.isFramed?(window.addEventListener("message",function(e){window.initTimeout&&clearTimeout(window.initTimeout),delete window.initTimeout,"object"===u(e.data)&&(window.pmsHostData=e.data),i()}),window.initTimeout=setTimeout(function(){i()},1e3),window.parent.postMessage({status:!0,get:"pmsHostData"},"*")):i()})},function(e,t,n){"use strict";function o(){return io("console/getUserData").then(function(e){return e.status&&d(e),e.status})}function i(e,t){return new Promise(function(n,o){if(!e||""===e)return n(r("empty_login","login"));if(!e||""===t)return n(r("empty_password","password"));showItemLoadIndicator("auth","login-button");var i={login:e,password:t};return n(io("console/auth",i))})}function r(e,t){var n=document.getElementById("auth-login"),o=document.getElementById("auth-login-message"),i=document.getElementById("auth-password"),r=document.getElementById("auth-password-message");if(t)switch(t){case"login":switch(e){case"empty_login":o.innerText="–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –≤–∞—à –ª–æ–≥–∏–Ω"}n.classList.toggle("highlight",!0);break;case"password":switch(e){case"empty_password":r.innerText="–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –≤–∞—à –ø–∞—Ä–æ–ª—å";break;case"incorrect_data":r.innerText="–£–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å"}i.classList.toggle("highlight",!0);break;case"all":switch(e){case"bad_parameters":o.innerText="–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –≤–∞—à –ª–æ–≥–∏–Ω",r.innerText="–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –≤–∞—à –ø–∞—Ä–æ–ª—å"}n.classList.toggle("highlight",!0),i.classList.toggle("highlight",!0)}return hideItemLoadIndicator("auth","login-button"),setProgress("auth-button",!1),auth.loginSection.classList.toggle("incorrect-data",!0),setTimeout(function(){auth.loginSection.classList.toggle("incorrect-data",!1)},500),console.log(e||t),!1}function s(){return l.login?m.render(l.login).then(a):m.loadTemplate("login").then(function(e){return e?l.login=e:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É"}).then(m.render).then(a)}function a(){return pms.currentHost&&(pms.currentHost.title&&document.getElementById("host-name")&&(document.getElementById("host-name").innerText=pms.currentHost.title),pms.currentHost.logo&&document.getElementById("host-logo")&&(document.getElementById("host-logo").src=pms.currentHost.logo),pms.currentHost.homePage&&document.getElementById("home-page")&&(document.getElementById("home-page").href=pms.currentHost.homePage)),document.getElementById("login-section")&&(auth.loginSection=document.getElementById("login-section")),document.getElementById("auth-button")&&document.getElementById("auth-button").addEventListener("click",function(){return!isProgress("auth-button")&&(!(!document.getElementById("auth-login")||!document.getElementById("auth-password"))&&(document.getElementById("auth-login").classList.toggle("highlight",!1),document.getElementById("auth-login-message").innerText="",document.getElementById("auth-password").classList.toggle("highlight",!1),document.getElementById("auth-password-message").innerText="",setProgress("auth-button"),showLoadingIndicator(),i(document.getElementById("auth-login").value,document.getElementById("auth-password").value).then(function(e){return!!e&&(e.status?(e.token&&localStorage.setItem("token",e.token),pms.onLeavePage.push(function(){hideItemLoadIndicator("auth","login-button")}),d(e),m.prepare()):r("incorrect_data","password"))}).then(hideLoadingIndicator).then(function(){return setProgress("auth-button",!1)})))}),!0}function d(e){return!(!e||!e.status)&&(pms.userData={},e.userId&&(pms.userData.id=e.userId),e.login&&(pms.userData.login=e.login),e.email&&(pms.userData.email=e.email),e.firstname&&(pms.userData.firstname=e.firstname),e.lastname&&(pms.userData.lastname=e.lastname),e.avamoji&&(pms.userData.avamoji=e.avamoji),(window.OneSignal||[]).push(["init",{appId:"d6d3da7e-593f-4b75-a598-a5d4b27e31e6",autoRegister:!0,notifyButton:{enable:!1},promptOptions:{actionMessage:"–£–≤–µ–¥–æ–º–∏–º –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Å–∞–π—Ç–æ–º, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –¥—Ä—É–≥–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö",acceptButtonText:"–ü–æ–ª—É—á–∞—Ç—å",cancelButtonText:"–û—Ç–∫–∞–∑–∞—Ç—å—Å—è"}}]),!0)}function c(){return io("console/logout").then(function(e){if(e&&e.status)return window.pms={config:pms.config},localStorage.clear(),s();alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞")})}Object.defineProperty(t,"__esModule",{value:!0}),t.check=o,t.send=i,t.showLogin=s;var u=n(0),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),l={};window.auth={logout:c}}]);
//# sourceMappingURL=init.js.map